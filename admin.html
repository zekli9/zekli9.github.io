<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Stark Cuboid Constructor</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; color: #0ff; font-family: 'Share Tech Mono', monospace; }
        #ui { position: absolute; inset: 0; pointer-events: none; padding: 25px; box-sizing: border-box; border: 1px solid rgba(0, 255, 255, 0.05); }
        .hud-data { font-size: 11px; letter-spacing: 1px; text-shadow: 0 0 8px #0ff; line-height: 1.5; }
        #start-btn { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            padding: 20px 40px; border: 1px solid #0ff; background: rgba(0, 255, 255, 0.1); color: #0ff;
            cursor: pointer; pointer-events: auto; z-index: 1000; font-family: inherit;
        }
        video { position: absolute; top: 20px; right: 20px; width: 90px; border-radius: 10px; border: 1px solid #0ff; transform: scaleX(-1); opacity: 0.3; }
        .glitch-text { animation: flicker 3s infinite; }
        @keyframes flicker { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
</head>
<body>
    <div id="ui">
        <div class="hud-data">
            <span class="glitch-text">MODEL: CUBOID_V1.0</span><br>
            DIMENSIONS: 400x400x400<br>
            RENDER_MODE: WIREFRAME_GHOST<br>
            --------------------------<br>
            GESTURE_CONTROL: ACTIVE
        </div>
        <button id="start-btn">ENGAGE CONSTRUCTION</button>
    </div>
    <video id="webcam" autoplay playsinline></video>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';

        let handX = 0, handY = 0, isHandActive = false;

        // --- Scene & Renderer ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // --- The Cuboid Structure ---
        const boxSize = 2;
        const geometry = new THREE.BoxGeometry(boxSize, boxSize, boxSize, 4, 4, 4);
        
        // 1. Solid-ish Transparent Shell
        const shellMat = new THREE.MeshBasicMaterial({ 
            color: 0x00ffff, 
            transparent: true, 
            opacity: 0.05, 
            side: THREE.DoubleSide 
        });
        const cubeShell = new THREE.Mesh(geometry, shellMat);
        
        // 2. Neon Wireframe
        const wireMat = new THREE.MeshBasicMaterial({ 
            color: 0x00ffff, 
            wireframe: true, 
            transparent: true, 
            opacity: 0.3,
            blending: THREE.AdditiveBlending 
        });
        const cubeWire = new THREE.Mesh(geometry, wireMat);

        // 3. Glowing Corner Vertices
        const pointsMat = new THREE.PointsMaterial({ 
            size: 0.08, 
            color: 0x00ffff, 
            blending: THREE.AdditiveBlending,
            transparent: true 
        });
        const cubePoints = new THREE.Points(geometry, pointsMat);

        // Group everything together
        const cubeGroup = new THREE.Group();
        cubeGroup.add(cubeShell, cubeWire, cubePoints);
        scene.add(cubeGroup);

        camera.position.z = 6;

        // --- Hand Tracking ---
        const hands = new Hands({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}` });
        hands.setOptions({ maxNumHands: 1, modelComplexity: 0 });
        hands.onResults(res => {
            if (res.multiHandLandmarks?.length) {
                isHandActive = true;
                const tip = res.multiHandLandmarks[0][8]; // Index Finger
                handX = (tip.x - 0.5) * -12;
                handY = (tip.y - 0.5) * -10;
            } else { isHandActive = false; }
        });

        document.getElementById('start-btn').onclick = (e) => {
            e.target.style.display = 'none';
            new Camera(document.getElementById('webcam'), {
                onFrame: async () => await hands.send({image: document.getElementById('webcam')}),
                width: 480, height: 360
            }).start();
        };

        // --- Animation ---
        function animate(t) {
            requestAnimationFrame(animate);
            const time = t * 0.001;

            const targetX = isHandActive ? handX : 0;
            const targetY = isHandActive ? handY : 0;

            // Follow hand with smooth interpolation
            cubeGroup.position.x += (targetX - cubeGroup.position.x) * 0.1;
            cubeGroup.position.y += (targetY - cubeGroup.position.y) * 0.1;

            // Rotate for 3D effect
            cubeGroup.rotation.y = time * 0.4;
            cubeGroup.rotation.x = time * 0.2;

            // Subtle pulsing of the neon lines
            wireMat.opacity = 0.2 + Math.sin(time * 3) * 0.15;
            pointsMat.size = 0.08 + Math.sin(time * 5) * 0.02;

            renderer.render(scene, camera);
        }
        animate(0);

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
